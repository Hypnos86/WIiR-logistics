{% extends 'base_plan.html' %}
{% load bootstrap %}
{% load static %}

{% block plan_content %}
<div class="container">
    <div class="list-group">
        {% for plan in plans %}
        <li class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
            <a href="{% url 'plan:detailsPlan' plan.id %}" class="w-75 text-decoration-none text-dark">
                {{ plan }}
                {% if plan.subtitle %}
                    ({{ plan.subtitle }})
                {% endif %}
            </a>
            <div class="d-flex justify-content-end w-25">
                <button type="button"
                        class="btn btn-outline-secondary btn-sm mx-1"
                        data-url="{% url 'plan:changesPlan' plan.id %}"
                        onclick="openHistoryModal(this)"
                        title="Historia zmian"
                        aria-label="Ostatnia zmiana">
                    Ostatnia zmiana: {{ plan.change|date:'d.m.Y' }} r.
                </button>
                <button type="button"
                        class="btn btn-outline-primary btn-sm mx-1"
                        title="Edytuj plan"
                        aria-label="Edytuj plan">
                    <i class="bi bi-pencil-square"></i>
                </button>
            </div>
        </li>
        {% endfor %}
    </div>
</div>

<!-- MODAL -->
<div class="modal fade" id="historyModal" tabindex="-1" aria-labelledby="historyModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <!-- Modal content will be loaded here -->
        </div>
    </div>
</div>

<script>
    function openHistoryModal(button) {
        var url = $(button).data("url");
        $("#historyModal .modal-content").load(url);
        $("#historyModal").modal("show");
    }
</script>
{% endblock %}